<!doctype html>
<html lang="en">
	<head>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script src="js/keys.js"></script>
		<script src='js/THREEx.KeyboardState.js'></script>

		<script>
		var scene, camera, renderer, controls, container;
		var car;
		var clock = new THREE.Clock();
		var keyboard = new THREEx.KeyboardState();
		
		init();
		animate();
			 
		function init() {
			scene = new THREE.Scene();
			var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
			var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH/SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
			camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
			scene.add(camera);
			camera.position.set(0, 42, 100);
			camera.lookAt(scene.position);

			renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );
			// load a texture, set wrap mode to repeat
			var texture = new THREE.TextureLoader().load( "textures/racetrackEdit.png" );
			var textureSky = new THREE.TextureLoader().load("textures/cloudy.jpg");

			var skyBoxGeometry = new THREE.CubeGeometry(10000, 10000, 10000);
			var skyBoxMaterial = new THREE.MeshBasicMaterial({map: textureSky, side: THREE.BackSide});
			var sky = new THREE.Mesh(skyBoxGeometry, skyBoxMaterial);
			scene.add(sky);
			
			var geometry = new THREE.PlaneGeometry( 1000, 1000, 10, 10);
//			var material = new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide } );
            var material = new THREE.MeshPhongMaterial( { map: texture, side: THREE.DoubleSide } );
			var plane = new THREE.Mesh( geometry, material );
			plane.position.y = -0.5;
			plane.rotation.x = Math.PI/2;
			
			scene.add( plane );	
			
			//car/cube
//			var carMaterial = new THREE.MeshBasicMaterial({color: 0x45a081, side: THREE.DoubleSide});
            var carMaterial = new THREE.MeshPhongMaterial({color: 0x45a081, side: THREE.DoubleSide});
			var carGeometry = new THREE.CubeGeometry(10, 10, 10, 1, 1, 1, carMaterial);
			car = new THREE.Mesh(carGeometry, carMaterial);
			car.castShadow = true;
			car.receiveShadow = true;
			car.position.set(0, 2.1, 0);
			scene.add(car);
			
			
			//lighting
			var light = new THREE.PointLight(0xffffff, 1, 2000, 1);
			light.position.set(0, 100, -100);
			light.castShadow = true;
			scene.add(light);
			
			
		}
		
		var car;

		function animate(){
			requestAnimationFrame(animate);
			renderer.render(scene, camera);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
			update();
		}
		
		function update() {
		  var delta = clock.getData();
		  var moveDistance = 200 * delta;
		  var rotationAngle = Math.PI/2*delta;
		  
		  if(keyboard.pressed(38)){
		    car.translateZ(-moveDistance);
		  }
		  if(keyboard.pressed(40)){
		    car.translateZ(moveDistance);
		  }
		  
		  var rotation_matrix = new THREE.Matrix4().identity();
		  if(keyboard.pressed(37)){
		    car.rotateOnAxis(new THREE.Vector3(0, 1, 0), rotationAngle);
		  }
		    if(keyboard.pressed(39)){
		    car.rotateOnAxis(new THREE.Vector3(0, 1, 0), -rotationAngle);
		  }
		 var cameraOffset = relativeCameraOffset.applyMatrix4(car.matrixWorld);
		  camera.position.x = cameraOffset.x;
		  camera.position.y = cameraOffset.y;
		  camera.position.z = cameraOffset.z;
		  camera.lookAt(car.position);
		}
		
		</script>
	</body>
</html>